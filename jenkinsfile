pipeline {
agent any
environment {
        GIT_REPO = 'https://github.com/sibilucky/dockerjenkins-.git'
        DOCKER_IMAGE = 'sibisam2301/my-alpine-image'
        DOCKER_REGISTRY_CREDENTIALS = credentials('dockerhub')
        DOCKER_USERNAME = 'sibisam2301'
    }

 stages {
        stage('Checkout') {
            steps {
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: 'demo', url: 'https://github.com/sibilucky/dockerjenkins-.git']])
                }
        }

 stage('Container Image Builds') {
            steps {
                    echo "sh -c  docker run -it my-alpine-image "
               }
            }

     stage('Push image to Docker Hub') {
            steps {
                script {
                     withCredentials([usernamePassword(credentialsId: 'dockerhub-credentials', usernameVariable: 'sibisam2301', passwordVariable: 'DOCKER_PASSWORD')]) {
                        sh '''
                            echo $DOCKER_PASSWORD | docker login -u sibisam2301 --password-stdin
                             echo "Docker login successful"
                        '''
                        echo "Pushing image to Docker Hub..."
                        sh docker push sibisam2301/my-alpine-image
                    }
                }
            }
        }
    }


    post {
        always {
              echo "Pipeline completed. Cleaning up resources..."
      }
   }
}
  
