pipeline {
    agent any
 environment {
        GIT_REPO = 'https://github.com/sibilucky/dockerjenkins-.git'
        DOCKER_IMAGE = 'sibisam2301/my-alpine-image'
        DOCKER_REGISTRY_CREDENTIALS = credentials('dockerhub')
        DOCKER_EMAIL = 'sibisam2301@gmail.com'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: 'demo', url: 'https://github.com/sibilucky/dockerjenkins-.git']])
                }
        }

        stage('Container Image Builds') {
            steps {
                    echo "sh -c 'docker run -it my-alpine-image'"
               }
            }

        stage('Push image to Docker Hub') {
            steps {
                script {
                    // Use withCredentials to handle DockerHub credentials securely
                 withCredentials([usernamePassword(credentialsId: 'dockerhub-credentials', passwordVariable: 'DOCKERHUB_CREDENTIALS_PSW', usernameVariable: 'DOCKERHUB_CREDENTIALS_USER')]) {
                    sh '''
                    echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USER --password-stdin
                     '''
                     // Use the DOCKER_PASSWORD variable here
                     sh 'docker build -t my-alpine-image'.
                    // Push the image to Docker Hub
                     sh 'docker push sibisam2301/my-alpine-image '
                }

                }
            }
        }
    }


    post {
        always {
              echo "Pipeline completed. Cleaning up resources..."
      }
   }
}
  
